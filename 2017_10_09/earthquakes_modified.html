<!DOCTYPE html>
    <html>
        <head>
            <title> Earthquake Data</title>
            <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

            <!-- Optional theme -->
            <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

            <!-- Custom styles for this template -->
            <link rel="shortcut icon" type="image/x-icon" href="/datavis-course/favicon.ico">  
            <link  rel="stylesheet" href="css/starter-template.css">
            <link rel="stylesheet" href="css/dc.css">
            <link rel="stylesheet" href="css/styles.css">
            <script src="js/crossfilter.js" charset="utf-8"></script>
            <script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
            <script src="js/dc.js" charset="utf-8"></script>

            
            <style type="text/css">
  
              
            </style>
        </head>
        <body>
            <div class='container-fluid'>
                <h1> Earthquakes in New Zealand </h1>
                <div id='magnitude-chart'>
                    <h4> Number of Events by Magnitude </h4>
                </div>
                <div id='depth-chart'>
                    <h4> Events by Depth (km) </h4>
                </div>   
                <div> 
                    <div id='time-chart'>
                        <h4> Events per hour </h4>
                    </div>
                </div>

                <table class="table table-hover" id="dc-table-graph">
                    <thead>
                        <tr class="header">
                            <th>DTG</th>
                            <th>Magnitude</th>
                            <th>Depth</th>
                            <th>Latitude</th>
                            <th>Longitude</th>
                        </tr>
                    </thead>
                </table>
            </div>
            <script type="text/javascript">

            let dataTable       = dc.dataTable('#dc-table-graph'),
                magnitudeChart  = dc.barChart('#magnitude-chart'),
                depthChart      = dc.barChart('#depth-chart'),
                timeChart       = dc.lineChart('#time-chart');

            d3.csv("earthquakes.csv", function (data) {
                let dtgFormat           = d3.time.format.utc("%Y-%m-%dT%H:%M:%S"),
                    americanDtgFormat   = d3.time.format("%m/%d/%Y");

                data.forEach(function(d){
                    d.dtg       = dtgFormat.parse(d.origintime.substr(0,19));
                    d.magnitude = d3.round(+d.magnitude,1);
                    d.depth     = d3.round(+d.depth,0);
                });

                let facts = crossfilter(data);

                let dateDimension       = facts.dimension(function(d){return d.dtg; }),
                    magnitudeDimension  = facts.dimension(function(d){return d.magnitude; }),
                    depthDimension        = facts.dimension(function(d){return d.depth; }),
                    hourDimension       = facts.dimension(function(d){return d3.time.hour(d.dtg); });

                let magnitudeDimensionCount = magnitudeDimension.group(),
                    depthDimensionCount     = depthDimension.group(),
                    hourDimensionCount      = hourDimension.group();

              magnitudeChart.width(480)
                .height(150)
                .margins({top: 10, right: 10, bottom: 20, left: 40})
                .dimension(magnitudeDimension)
                .group(magnitudeDimensionCount)
                .transitionDuration(500)
                .centerBar(true)
                .gap(56)
                .x(d3.scale.linear().domain([0, 8]))
                .elasticY(true);

              depthChart.width(480)
                .height(150)
                .margins({top: 10, right: 10, bottom: 20, left: 40})
                .dimension(depthDimension)
                .group(depthDimensionCount)
                .x(d3.scale.linear().domain([0, 100]))
                .transitionDuration(500)
                .elasticY(true);
             
              timeChart.width(960)
                .height(150)
                .margins({top: 10, right: 10, bottom: 20, left: 40})
                .dimension(hourDimension)
                .group(hourDimensionCount)
                .x(d3.time.scale().domain(d3.extent(data, function(d) { return d.dtg; })))
                .xUnits(d3.time.days)
                .renderHorizontalGridLines(true)
                .elasticY(true)
                .brushOn(false);

              dataTable.width(960)
                .height(800)
                .dimension(dateDimension)
                .group(function(d){ return "Earthquake Table"; })
                .size(10)
                .columns([
                  function(d){ return d.dtg; },
                  function(d){ return d.magnitude; },
                  function(d){ return d.depth; },
                  function(d){ return d.latitude; },
                  function(d){ return d.longitude; },
                  ])
                .sortBy(function(d){ return d.dtg; })
                .order(d3.ascending);

              dc.renderAll();
  
            });
            </script>

            <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
            <!-- Include all compiled plugins (below), or include individual files as needed -->
             <!-- Latest compiled and minified JavaScript -->
            <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
                
        </body>
</html>